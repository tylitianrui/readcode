# 服务发现
作为监控系统，`prometheus`首先要解决的就是"`要监控谁`"的问题。静态配置比较适合`targets`基本稳定不变的场景，云原生体系下静态配置就相形见绌了(*注：在[001.prometheus简述](001.prometheus简述.md)章节已经做了简述*）。本章主要讨论**服务发现**。

`prometheus` 定义了很多`Manager`,例如负责服务发现的`discoveryManager`、



















## 服务发现原理
`prometheus` 定义了 `Discoverer` 接口(*定义文件：`discovery/discovery.go`*)。`prometheus`中。 `Discoverer` 接口只有一个方法` Run(ctx context.Context, up chan<- []*targetgroup.Group) `。 `targets `变化都可以通过监听 `up chan` 获取到。我们将以`kubernetes`为例进行说明。  

**`Discoverer` 接口定义**:  
```go
// Discoverer provides information about target groups. It maintains a set
// of sources from which TargetGroups can originate. Whenever a discovery provider
// detects a potential change, it sends the TargetGroup through its channel.
//
// Discoverer does not know if an actual change happened.
// It does guarantee that it sends the new TargetGroup whenever a change happens.
//
// Discoverers should initially send a full set of all discoverable TargetGroups.

type Discoverer interface {
	// Run hands a channel to the discovery provider (Consul, DNS, etc.) through which
	// it can send updated target groups. It must return when the context is canceled.
	// It should not close the update channel on returning.
	Run(ctx context.Context, up chan<- []*targetgroup.Group)
}

```
